---
title: "Getting Started with TernTables"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with TernTables}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  comment   = "#>",
  warning   = FALSE,
  message   = FALSE
)
library(TernTables)
```

## Overview

**TernTables** generates publication-ready summary tables for clinical research.
Given a data frame and an optional grouping variable, it automatically:

- Detects each variable's type (continuous, binary/categorical, or ordinal)
- Selects the appropriate statistical test
- Formats p-values and summary statistics for publication

## Example Dataset

```{r load-data}
data(tern_colon)
```

`tern_colon` is bundled with TernTables. It contains 929 patients from a
landmark colon cancer adjuvant chemotherapy trial (Moertel et al., 1990),
filtered to the recurrence endpoint — one row per patient. See
`?tern_colon` for full details.

Key variables used in these examples:

| Column | Description |
|---|---|
| `Age_Years` | Age at registration (years) |
| `Sex` | Female / Male |
| `Colonic_Obstruction` | Colonic obstruction present (N / Y) |
| `Bowel_Perforation` | Bowel perforation present (N / Y) |
| `Positive_Lymph_Nodes_n` | Number of positive lymph nodes |
| `` >_4_Positive_Nodes `` | More than 4 positive lymph nodes (N / Y) |
| `Tumor_Adherence` | Tumour adherence to nearby organs (N / Y) |
| `Tumor_Differentiation` | Well / Moderate / Poor |
| `Extent_of_Local_Spread` | Depth of tumour penetration (4 levels) |
| `Recurrence` | No Recurrence / Recurrence — **2-group** |
| `Treatment_Arm` | Levamisole + 5FU / Levamisole / Observation — **3-group** |

---

## Descriptive Table (`ternD`)

Use `ternD()` when you have a single cohort and want a summary of all variables
without group comparisons.

```{r ternD-example}
TernDesc <- ternD(
  data               = tern_colon,
  exclude_vars       = c("ID"),
  consider_normality = TRUE
)
TernDesc
```

Continuous variables show mean ± SD or median \[IQR\] depending on normality
(Shapiro-Wilk, p > 0.05 = normal). Binary columns are automatically detected
as categorical and shown as n (%).

---

## Two-Group Comparison (`ternG` — 2 levels)

Compare baseline characteristics between patients with and without recurrence.

```{r ternG-2group}
Tern2v <- ternG(
  data               = tern_colon,
  exclude_vars       = c("ID"),
  group_var          = "Recurrence",
  consider_normality = TRUE,
  OR_col             = TRUE,
  show_test          = TRUE,
  insert_subheads    = TRUE
)
Tern2v
```

The `p` column shows the test p-value; `test` shows which test was applied;
`OR` shows the odds ratio with 95% CI where applicable.

---

## Three-Group Comparison (`ternG` — 3 levels)

The same `ternG()` function handles 3-level groups automatically, switching to
ANOVA or Kruskal-Wallis for continuous variables.

```{r ternG-3group}
Tern3v <- ternG(
  data               = tern_colon,
  exclude_vars       = c("ID"),
  group_var          = "Treatment_Arm",
  group_order        = c("Observation", "Levamisole", "Levamisole + 5FU"),
  consider_normality = TRUE,
  show_test          = TRUE,
  insert_subheads    = TRUE
)
Tern3v
```

---

## Exporting Results

### Word document

`word_export()` formats any TernTables tibble as a publication-ready
flextable and writes it to a `.docx` file.

```{r export-word, eval = FALSE}
word_export(
  tbl      = Tern3v,
  filename = "colon_treatment_table.docx",
  category_start = c(
    "Patient Demographics"  = "Age (yr)",
    "Surgical Findings"     = "Colonic Obstruction",
    "Tumor Characteristics" = "Positive Lymph Nodes (n)",
    "Outcomes"              = "Recurrence"
  )
)
```

### Excel

```{r export-excel, eval = FALSE}
writexl::write_xlsx(Tern3v, "colon_treatment_table.xlsx")
```

### Methods document

`write_methods_doc()` generates a boilerplate methods paragraph describing the
statistical tests used, ready to paste into a manuscript.

```{r methods-doc, eval = FALSE}
write_methods_doc(
  tbl      = Tern3v,
  filename = "methods.docx"
)
```

---

## Category Headers

Use `category_start` in `ternD()` or `ternG()` to insert bold section
headers grouping related variables:

```{r category-headers, eval = FALSE}
ternD(
  data           = tern_colon,
  exclude_vars   = c("ID"),
  output_docx    = "descriptive.docx",
  category_start = c(
    "Patient Demographics"  = "Age (yr)",
    "Surgical Findings"     = "Colonic Obstruction",
    "Tumor Characteristics" = "Positive Lymph Nodes (n)",
    "Outcomes"              = "Recurrence"
  )
)
```

The named character vector maps section titles to the display name of the first
variable in each section (either the raw column name or the cleaned display
label both work as anchors).

---

## Statistical Test Logic

TernTables selects tests automatically:

| Variable type | Test (2 groups) | Test (3+ groups) |
|---|---|---|
| Continuous, normal | Welch's *t*-test | ANOVA |
| Continuous, non-normal | Wilcoxon rank-sum | Kruskal-Wallis |
| Binary / Categorical | Fisher's exact or Chi-squared* | Fisher's exact or Chi-squared* |
| Ordinal (`force_ordinal`) | Wilcoxon rank-sum | Kruskal-Wallis |

\*Fisher's exact is used when any expected cell count is < 5.

Normality is assessed with the Shapiro-Wilk test (p > 0.05 = normal). For
3-group continuous comparisons, Levene's test additionally checks homogeneity
of variance; if violated, Kruskal-Wallis is used regardless of normality.

---

## References

Moertel CG, Fleming TR, Macdonald JS, et al. (1990). Levamisole and fluorouracil
for adjuvant therapy of resected colon carcinoma. *New England Journal of Medicine*,
**322**(6), 352–358. <https://doi.org/10.1056/NEJM199002083220602>
